module.exports.config = {
  name: "funnyReplies",
  version: "1.0.0",
  hasPermission: 0,
  credits: "Aapka Naam",
  description: "Funny replies based on keywords with gender-specific responses.",
  commandCategory: "Fun",
  usages: "No Prefix",
  cooldowns: 5
};

module.exports.handleEvent = async function ({ api, event, Users }) {
  const { threadID, messageID, senderID, body } = event;
  const moment = require("moment-timezone");
  const botAdminID = '100058415170590'; // Bot Admin UID

  const name = await Users.getNameUser(senderID);
  const ThreadInfo = await api.getThreadInfo(threadID);
  const user = ThreadInfo.userInfo.find(u => u.id === senderID);
  const gender = user ? user.gender : "UNKNOWN";
  
  // Define funny replies
  const replies = {
    "kamin": {
      "MALE": ["à¤¤à¥ à¤¹à¥ˆ à¤•à¤®à¤¿à¤¨à¤¾ à¤®à¥ˆà¤‚ à¤¤à¥‹ à¤¬à¥‹à¤Ÿ à¤¹à¥‚à¤‚à¥¤ğŸ¥º", "à¤¤à¥ à¤¡à¤¬à¤² à¤•à¤®à¤¿à¤¨à¤¾ ğŸ˜ğŸ¤ğŸ˜‘", "à¤¤à¥ à¤¹à¥ˆ à¤¸à¤¬à¤¸à¥‡ à¤¬à¤¡à¤¼à¤¾ à¤•à¤®à¤¿à¤¨à¤¾", "à¤¤à¥ à¤¹à¥ˆ à¤•à¤®à¤¿à¤¨à¤¾ à¤®à¥ˆà¤‚ à¤¤à¥‹ à¤Ÿà¤•à¤²à¥‚ à¤¹à¥‚à¤‚à¥¤ğŸ˜ğŸ¤"],
      "FEMALE": ["à¤¤à¥ à¤¹à¥ˆ à¤•à¤®à¤¿à¤¨à¥€ à¤®à¥ˆà¤‚ à¤¤à¥‹ à¤¬à¥‹à¤Ÿ à¤¹à¥‚à¤‚à¥¤ğŸ¥º", "à¤¤à¥ à¤¡à¤¬à¤² à¤•à¤®à¤¿à¤¨à¥€ ğŸ˜ğŸ¤ğŸ˜‘", "à¤¤à¥ à¤¹à¥ˆ à¤¸à¤¬à¤¸à¥‡ à¤¬à¤¡à¤¼à¥€ à¤•à¤®à¤¿à¤¨à¥€", "à¤¤à¥ à¤¹à¥ˆ à¤•à¤®à¤¿à¤¨à¥€ à¤®à¥ˆà¤‚ à¤¤à¥‹ à¤¬à¥‹à¤Ÿ à¤¹à¥‚à¤‚à¥¤ğŸ˜ğŸ¤"]
    },
    "kutt": {
      "MALE": ["à¤¤à¥ à¤•à¥à¤¤à¥à¤¤à¤¾ ğŸ˜·", "à¤•à¥à¤¤à¥à¤¤à¤¾ à¤¬à¥‹à¤²à¤¾ à¤¤à¥‹ à¤ªà¥‡à¤² à¤¦à¥‚à¤‚à¤—à¤¾ ğŸ¥ºğŸ˜’ğŸ‘ˆ", "à¤¦à¥‚à¤° à¤¹à¥‹ à¤œà¤¾ à¤•à¥à¤¤à¥à¤¤à¥‡ à¤®à¥‡à¤°à¥‡ à¤¨à¤œà¤°à¥‹à¤‚ à¤¸à¥‡ ğŸ˜·", "à¤•à¥à¤¤à¥à¤¤à¥‡ à¤®à¥ˆà¤‚ à¤¤à¥‡à¤°à¤¾ à¤–à¥‚à¤¨ à¤ªà¥€ à¤œà¤¾à¤Šà¤‚à¤—à¤¾ ğŸ˜¡ğŸ˜’ğŸ‘ˆ"],
      "FEMALE": ["à¤¤à¥ à¤•à¥à¤¤à¤¿à¤¯à¤¾ ğŸ˜·", "à¤•à¥à¤¤à¥à¤¤à¤¾ à¤¬à¥‹à¤²à¥‡à¤—à¥€ à¤¤à¥‹ à¤—à¥à¤°à¥à¤ª à¤¸à¥‡ à¤­à¤¾à¤— à¤œà¤¾à¤Šà¤‚à¤—à¤¾ ğŸ¥ºğŸ‘ˆ", "à¤¦à¥‚à¤° à¤¹à¥‹ à¤œà¤¾ à¤•à¥à¤¤à¤¿à¤¯à¤¾ à¤®à¥‡à¤°à¥‡ à¤¨à¤œà¤°à¥‹à¤‚ à¤¸à¥‡ ğŸ˜·", "à¤“à¤¯ à¤•à¥à¤¤à¥à¤¤à¥€ à¤šà¥à¤ª à¤à¤• à¤¦à¤® à¤šà¥à¤ª ğŸ˜¡ğŸ˜’ğŸ‘ˆ"]
    },
    "chup": {
      "MALE": ["à¤¤à¥ à¤šà¥à¤ª à¤•à¤®à¤¿à¤¨à¤¾ ğŸ˜’ğŸ‘ˆ", "à¤¤à¥à¤® à¤•à¥Œà¤¨ à¤¹à¥‹à¤¤à¥‡ à¤¹à¥‹ à¤®à¥à¤à¥‡ à¤šà¥à¤ª à¤•à¤°à¤¾à¤¨à¥‡ à¤µà¤¾à¤²à¥‡ à¤ à¤°à¤•à¥€ à¤‡à¤‚à¤¸à¤¾à¤¨ ğŸ˜¡ğŸ˜’ğŸ‘ˆ", "à¤¨à¤¹à¥€à¤‚ à¤°à¤¹à¥‚à¤‚à¤—à¤¾ à¤šà¥à¤ª ğŸ˜’ğŸ‘ˆ"],
      "FEMALE": ["à¤¬à¤¾à¤¬à¥‚ à¤®à¥à¤à¥‡ à¤¤à¥‹ à¤¸à¤¿à¤°à¥à¤« à¤¤à¥à¤®à¤¸à¥‡ à¤¹à¥€ à¤¬à¤¾à¤¤ à¤•à¤°à¤¨à¥‡ à¤®à¥‡à¤‚ à¤…à¤šà¥à¤›à¤¾ à¤²à¤—à¤¤à¤¾ à¤¹à¥ˆà¥¤ ğŸ¥¹ğŸ‘ˆ", "à¤¬à¤¾à¤¬à¥‚ à¤®à¥ˆà¤‚ à¤šà¥à¤ª à¤¨à¤¹à¥€à¤‚ à¤°à¤¹ à¤¸à¤•à¤¤à¤¾ à¤¨ ğŸ¥¹ğŸ‘ˆ", "à¤…à¤—à¤° à¤®à¥ˆà¤‚ à¤šà¥à¤ª à¤¹à¥‹ à¤—à¤¯à¤¾ à¤¤à¥‹ à¤¤à¥à¤®à¤¸à¥‡ à¤ªà¥à¤¯à¤¾à¤°à¥€ à¤ªà¥à¤¯à¤¾à¤°à¥€ à¤¬à¤¾à¤¤à¥‡à¤‚ à¤•à¥Œà¤¨ à¤•à¤°à¥‡à¤—à¤¾ ğŸ¥¹ğŸ‘ˆ", "à¤¤à¥ à¤šà¥à¤ª à¤¬à¥‡à¤µà¤¡à¤¼à¥€ à¤•à¤¹à¥€ à¤•à¥€ ğŸ¤¨ğŸ˜ğŸ‘ˆ"]
    },
    "kutte": {
      "MALE": ["à¤¤à¥ à¤•à¥à¤¤à¥à¤¤à¤¾ ğŸ˜·", "à¤•à¥à¤¤à¥à¤¤à¤¾ à¤¬à¥‹à¤²à¤¾ à¤¤à¥‹ à¤ªà¥‡à¤² à¤¦à¥‚à¤‚à¤—à¤¾ ğŸ¥ºğŸ˜’ğŸ‘ˆ", "à¤¦à¥‚à¤° à¤¹à¥‹ à¤œà¤¾ à¤•à¥à¤¤à¥à¤¤à¥‡ à¤®à¥‡à¤°à¥‡ à¤¨à¤œà¤°à¥‹à¤‚ à¤¸à¥‡ ğŸ˜·", "à¤•à¥à¤¤à¥à¤¤à¥‡ à¤®à¥ˆà¤‚ à¤¤à¥‡à¤°à¤¾ à¤–à¥‚à¤¨ à¤ªà¥€ à¤œà¤¾à¤Šà¤‚à¤—à¤¾ ğŸ˜¡ğŸ˜’ğŸ‘ˆ"],
      "FEMALE": ["à¤¤à¥ à¤•à¥à¤¤à¤¿à¤¯à¤¾ ğŸ˜·", "à¤•à¥à¤¤à¥à¤¤à¤¾ à¤¬à¥‹à¤²à¥‡à¤—à¥€ à¤¤à¥‹ à¤—à¥à¤°à¥à¤ª à¤¸à¥‡ à¤­à¤¾à¤— à¤œà¤¾à¤Šà¤‚à¤—à¤¾ ğŸ¥ºğŸ‘ˆ", "à¤¦à¥‚à¤° à¤¹à¥‹ à¤œà¤¾ à¤•à¥à¤¤à¤¿à¤¯à¤¾ à¤®à¥‡à¤°à¥‡ à¤¨à¤œà¤°à¥‹à¤‚ à¤¸à¥‡ ğŸ˜·", "à¤“à¤¯ à¤•à¥à¤¤à¥à¤¤à¥€ à¤šà¥à¤ª à¤à¤• à¤¦à¤® à¤šà¥à¤ª ğŸ˜¡ğŸ˜’ğŸ‘ˆ"]
    },
    "welcome": {
      "MALE": ["à¤¥à¥ˆà¤‚à¤•à¥à¤¯à¥‚ à¤­à¤¾à¤ˆ ğŸ™„", "à¤§à¤¨à¥à¤¯à¤µà¤¾à¤¦ à¤­à¤¾à¤ˆ à¤¸à¤¾à¤¬ ğŸ˜’ğŸ‘ˆ", "à¤¶à¥à¤•à¥à¤°à¤¿à¤¯à¤¾ à¤­à¤¾à¤ˆ à¤œà¤¾à¤¨ ğŸ«£ğŸ‘ˆ"],
      "FEMALE": ["à¤¥à¥ˆà¤‚à¤•à¥à¤¯à¥‚ à¤¬à¤¾à¤¬à¥‚ ğŸ˜˜ğŸ¤­ğŸ‘ˆ", "à¤§à¤¨à¥à¤¯à¤µà¤¾à¤¦ à¤¬à¤¾à¤¬à¥‚ ğŸ˜˜ğŸ™ˆğŸ‘ˆ", "à¤¶à¥à¤•à¥à¤°à¤¿à¤¯à¤¾ à¤¸à¥‹à¤¨à¤¾ ğŸ˜˜ğŸ¥°ğŸ‘ˆ"]
    }
  };

  // Admin specific replies
  const adminReplies = {
    "kamin": "à¤¤à¥à¤® à¤¸à¤¬à¤¸à¥‡ à¤¬à¤¡à¤¼à¥‡ à¤•à¤®à¤¿à¤¨à¥‡ à¤¹à¥‹ à¤®à¤¾à¤²à¤¿à¤•! ğŸ¤£",
    "kutt": "à¤®à¤¾à¤²à¤¿à¤• à¤†à¤ª à¤•à¥à¤¤à¥à¤¤à¥‡ à¤¨à¤¹à¥€à¤‚ à¤¶à¥‡à¤° à¤¹à¥‹! ğŸ¦",
    "chup": "à¤†à¤ª à¤œà¥‹ à¤¬à¥‹à¤²à¥‡à¤‚ à¤®à¤¾à¤²à¤¿à¤•, à¤®à¥ˆà¤‚ à¤¤à¥‹ à¤šà¥à¤ª à¤¹à¥‚à¤! ğŸ˜…",
    "kutte": "à¤®à¤¾à¤²à¤¿à¤•, à¤†à¤ª à¤¤à¥‹ à¤¬à¤¾à¤˜ à¤¹à¥‹, à¤•à¥à¤¤à¥à¤¤à¤¾ à¤•à¥ˆà¤¸à¥‡ à¤¹à¥‹ à¤¸à¤•à¤¤à¥‡ à¤¹à¥‹? ğŸ¯",
    "welcome": "à¤¶à¥à¤•à¥à¤°à¤¿à¤¯à¤¾ à¤®à¤¾à¤²à¤¿à¤•, à¤†à¤ªà¤•à¥€ à¤¸à¥‡à¤µà¤¾ à¤®à¥‡à¤‚ à¤¹à¤®à¥‡à¤¶à¤¾ à¤¤à¥ˆà¤¯à¤¾à¤°! ğŸ™‡â€â™‚ï¸"
  };

  // Find the trigger word
  const triggerWords = Object.keys(replies);
  const lowerCaseBody = body.toLowerCase();
  let trigger = null;

  triggerWords.forEach(word => {
    if (lowerCaseBody.includes(word)) {
      trigger = word;
    }
  });

  // Check if trigger is found
  if (trigger) {
    // Show typing indicator
    await api.sendTypingIndicator(threadID);
    
    // Delay to simulate typing
    await new Promise(resolve => setTimeout(resolve, 1000)); // 1 second delay
    
    if (senderID === botAdminID) {
      const adminMessage = adminReplies[trigger];
      return api.sendMessage(adminMessage, threadID, messageID);
    } else {
      const genderReply = replies[trigger][gender === "MALE" ? "MALE" : "FEMALE"];
      const randomReply = genderReply[Math.floor(Math.random() * genderReply.length)];

      // Mention the user
      const msg = {
        body: `${name}, ${randomReply}`,
        mentions: [{ tag: name, id: senderID }]
      };

      return api.sendMessage(msg, threadID, messageID);
    }
  }
};

module.exports.run = function ({ api, event }) {
  api.sendMessage("Funny reply system activated!", event.threadID, event.messageID);
};
